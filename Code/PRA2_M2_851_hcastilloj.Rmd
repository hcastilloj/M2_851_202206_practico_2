---
title: 'M2.851 - Tipología y ciclo de vida de los datos: Practico 2'
author: "Autor: Héctor Alejandro Castillo Jeria"
date: "Junio 2022"
output:
  html_document:
    highlight: default
    number_sections: yes
    theme: cosmo
    toc: yes
    toc_depth: 2
    includes:
      in_header: UOC-header.html
  word_document: default
  pdf_document:
    highlight: zenburn
    toc: yes
editor_options: 
  markdown: 
    wrap: 72
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```

------------------------------------------------------------------------

# Introducción

Este documento contiene el desarrollo del Práctico número 2, en el cual, se elabora un caso práctico orientado a aprender a identificar los datos relevantes para un proyecto analítico y usar las herramientas de integración, limpieza, validación y análisis de las mismas.

------------------------------------------------------------------------

# Competencias

En esta práctica se desarrollan las siguientes competencias del Máster de Data Science:

> Capacidad de analizar un problema en el nivel de abstracción adecuado a cada situación 
y aplicar las habilidades y conocimientos adquiridos para abordarlo y resolverlo.
>
> Capacidad para aplicar las técnicas específicas de tratamiento de datos (integración, 
transformación, limpieza y validación) para su posterior análisis

------------------------------------------------------------------------


# Objetivos

Los objetivos concretos de esta práctica son:

> Aprender a aplicar los conocimientos adquiridos y su capacidad de resolución de problemas en entornos nuevos o poco conocidos dentro de contextos más amplios o multidisciplinares.
>
> Saber identificar los datos relevantes y los tratamientos necesarios (integración, limpieza 
y validación) para llevar a cabo un proyecto analítico.
>
> Aprender a analizar los datos adecuadamente para abordar la información contenida en los datos.
>
> Identificar la mejor representación de los resultados para aportar conclusiones sobre el problema planteado en el proceso analítico.
>
> Actuar con los principios éticos y legales relacionados con la manipulación de datos en función del ámbito de aplicación.
>
> Desarrollar las habilidades de aprendizaje que les permitan continuar estudiando de un modo que tendrá que ser en gran medida autodirigido o autónomo.
>
> Desarrollar la capacidad de búsqueda, gestión y uso de información y recursos en el ámbito de la ciencia de datos. 

------------------------------------------------------------------------

# Importancia de los análisis

A partir de este conjunto de datos se plantea la problemática de determinar qué variables son las que más influyen en la sobrevivencia o no de los pasajeros del RMS Titanic.

Además, se pretende crear modelos predictivos para emplearlos en el set de datos de test y determinar las probabilidades de que un pasajero pueda o no sobrevivir a la tragedia.

------------------------------------------------------------------------

# Inicio de Actividad.

## Comprensión de los datos.

La muestra con la que trabajaremos corresponde a los datos de pasajeros del **RMS Titanic**, famoso transatlantico que sufre un accidente y se hunde en us viaje inaugural, el día 15 de Abril de 1912, donde fallecen 1502 de sus 2224 pasajeros y tripulantes.

Este juego de datos se encuentra en los archivo **train.csv** y **test.csv** ambos archivos, obtenido desde Kaggle **"Titanic - Machine Learning from Disaster"** <https://www.kaggle.com/competitions/titanic>

El archivo **train.csv** posee la información de los pasajeros, lo que permitirá entrenar nuestro modelo, para emplear luego el archivo **test.csv** que contiene información de pasajeros, para predecir si los pasajeros de esta muestra sobreviven al hundimiento del Titanic, de acuerdo a ciertos factores que obtendremos en el desarrollo de práctico.



## Carga de librerias y fichero de datos.

Instalamos y cargamos las librerías ggplot2 y dplry.

```{r echo=TRUE, message=FALSE, warning=FALSE}
# https://cran.r-project.org/web/packages/ggplot2/index.html
if (!require('ggplot2')) install.packages('ggplot2'); library('ggplot2')
# https://cran.r-project.org/web/packages/dplyr/index.html
if (!require('dplyr')) install.packages('dplyr'); library('dplyr')

if(!require(grid)){
    install.packages('grid', repos='http://cran.us.r-project.org')
    library(grid)
}
if(!require(gridExtra)){
    install.packages('gridExtra', repos='http://cran.us.r-project.org')
    library(gridExtra)
}
```

Cargamos los ficheros de datos *train.csv* y *test.csv*.

```{r}
trainData <- read.csv('train.csv',stringsAsFactors = FALSE)
testData  <- read.csv('test.csv' ,stringsAsFactors = FALSE)

```

```{r echo=FALSE, message=FALSE, warning=FALSE}
filasTrain  = dim(trainData)[1]
columTrain = length(trainData)
filasTest  = dim(testData)[1]
columTest  = length(testData)

```



## Exploración de la base de datos de **test**

Calcularemos las dimensiones de nuestra base de datos y analizaremos qué tipos de atributos tenemos. Mediante la función dim(). 

```{r}
dim(testData)
```

Como parte de la preparación de los datos, verificaremos si hay valores missing.

```{r}
missing <- testData[is.na(testData),]
dim(missing)
```


Verificamos la estructura del juego de datos principal.

```{r}
str(testData)
```

En nuestra carga de datos, vemos que tenemos `r filasTest` registros (filas) que se
corresponden a las reseñas y `r columTest` variables (columnas) que los caracterizan.

Revisamos la descripción de las variables contenidas al fichero y si los
tipos de variable se corresponde al que hemos cargado:


 **Atributo**    |    **Descripción**   
-----------------|--------------------------------------------------------------------------
 **PassengerId** | Número Identificador del pasajero 
 **Pclass** | Clase Pasajero (1=primera Clase; 2=Segunda Clase; 3=Tercera Clase) 
 **Name** | Nombre 
 **Sex** | Sexo 
 **Age** | Edad 
 **SibSp** | Número de hermanos/cónyuges a bordo 
 **Parch** | Número de padres/hijos a bordo 
 **Ticket** | Número de Ticket 
 **Fare** | Tarifa de pasajero 
 **Cabin** | Cabina 
 **Embarked** | Puerto de embarque (C=Cherbourg; Q=Queenstown; S=Southampton) 



### Validación de la data **test**.

Obtendremos estadísticas básicas, para luego trabajar con los atributos que no poseen valores o se encuentran vacíos.

Estadísticas básicas
```{r echo=TRUE, message=FALSE, warning=FALSE}
summary(testData)
```

Verificación de valores vacíos.

```{r}
colSums(is.na(testData))
colSums(testData=="")
```

Las estadísticas obtenidas indican lo siguiente sobre la data:

> El atributo **Age**, posee 86 datos vacíos, como este dato es relevante y puede influir en el resultado del análisis, el registro será eliminado.
> 
> El atributo **Fare**, posee 1 dato vacío, este dato no es relevante y se cargará el valor 0 por defecto.
> 
> El atributo **Cabin**, posee 327 datos vacíos, este dato no es relevante y se eliminará el atributo.
> 
> El atributo **Name**, este dato no es relevante y se eliminará el atributo.
> 
> El atributo **PassengerId**, este dato no es relevante y se eliminará el atributo.



## Exploración de la base de datos de **train**

Calcularemos las dimensiones de nuestra base de datos y analizaremos qué tipos de atributos tenemos. Mediante la función dim(). Obtenemos que disponemos de `r length(trainData$PassengerId)` registros (filas) y `r length(trainData)` variables (columnas). 

```{r}
dim(trainData)
```

Como parte de la preparación de los datos, verificaremos si hay valores missing.

```{r}
missing <- trainData[is.na(trainData),]
dim(missing)
```


Verificamos la estructura del juego de datos principal.

```{r}
str(trainData)
```

En nuestra carga de datos, vemos que tenemos `r filasTrain` registros (filas) que se
corresponden a las reseñas y `r columTrain` variables (columnas) que los caracterizan.

Revisamos la descripción de las variables contenidas al fichero y si los
tipos de variable se corresponde al que hemos cargado:

 **Atributo**    |    **Descripción**   
-----------------|--------------------------------------------------------------------------
 **PassengerId** | Número Identificador del pasajero 
 **Survived** | Sobreviviente (0=No; 1=Si)
 **Pclass** | Clase Pasajero (1=primera Clase; 2=Segunda Clase; 3=Tercera Clase) 
 **Name** | Nombre 
 **Sex** | Sexo 
 **Age** | Edad 
 **SibSp** | Número de hermanos/cónyuges a bordo 
 **Parch** | Número de padres/hijos a bordo 
 **Ticket** | Número de Ticket 
 **Fare** | Tarifa de pasajero 
 **Cabin** | Cabina 
 **Embarked** | Puerto de embarque (C=Cherbourg; Q=Queenstown; S=Southampton) 



### Validación de la data **train**.

Obtendremos estadísticas básicas, para luego trabajar con los atributos que no poseen valores o se encuentran vacíos.

Estadísticas básicas

```{r echo=TRUE, message=FALSE, warning=FALSE}
summary(trainData)
```


Estadísticas de valores vacíos.

```{r}
colSums(is.na(trainData))
colSums(trainData=="")
```

Las estadísticas obtenidas indican lo siguiente sobre la data:

> El atributo **Age**, posee 177 datos vacíos, como este dato es relevante y puede influir en el resultado del análisis, el registro será eliminado.
> 
> El atributo **Cabin**, posee 687 datos vacíos, este dato no es relevante y se eliminará el atributo.
> 
> El atributo **Embarked**, posee 2 datos vacíos, este dato no es relevante y se cargará un valor por defecto.
> 
> El atributo **Name**, este dato no es relevante y se eliminará el atributo.
> 
> El atributo **PassengerId**, este dato no es relevante y se eliminará el atributo.


------------------------------------------------------------------------


## Preparación de los datos.

En este paso realizaremos la normalización de algunos atributos, la clusterización de otros, la eliminación de datos no relevantes, la creación de nuevos atributos, basicamente en este punto tomamos el set de datos, para luego aplicar tecnicas de normalización, completar atributos inexistentes, agregar valores por defecto, incorporar un atributo empleando formulas estadisticas como la media. Como ejemplo. En este punto, a los atributos de tipo texto, le cargaremos el valor por defecto "desconocido", cuando el atributo es nulo o vacío.



### Reemplazo de valores nulos o vacíos.

```{r}
testData$Age[is.na(testData$Age)] <- mean(testData$Age[is.na(testData$Age)==FALSE])
testData$Fare[is.na(testData$Fare)] <- 0

```



### Eliminación de registros con valores nulos o vacíos.

```{r}
testData <- subset(testData, !is.na(testData$Age))
trainData <- subset(trainData, !is.na(trainData$Age))

trainData <- subset(trainData, !is.na(trainData$Embarked))
trainData <- subset(trainData, trainData$Embarked!="")

```



### Eliminación de atributos.

```{r}
testData  <- subset( testData, select = -c(PassengerId, Cabin, Name, Ticket ) )
trainData <- subset( trainData, select = -c(PassengerId, Cabin, Name, Ticket ) )

```



Verificación de corrección de valores vacíos **test**.

```{r}
colSums(is.na(testData))
colSums(testData=="")
```


Verificación de corrección de valores vacíos **train**.

```{r}
colSums(is.na(trainData))
colSums(trainData=="")
```


### Creación de nuevos atributos.

Agregaremos un nuevo campo a los datos. Este campo contendrá el valor de la edad discretitzada con un método simple de intervalos de igual amplitud.

```{r echo=TRUE, message=FALSE, warning=FALSE}

summary(trainData[,"Age"])
summary(testData[,"Age"])
```

Discretizamos con intervalos.

```{r}
trainData["Rango_Age"] <- cut(trainData$Age, breaks = c(0,10,20,30,40,50,60,70,80,110), labels = c("0-9","10-19","20-29","30-39","40-49","50-59","60-69","70-79","80-100"))
testData["Rango_Age"]  <- cut(testData$Age , breaks = c(0,10,20,30,40,50,60,70,80,100), labels = c("0-9","10-19","20-29","30-39","40-49","50-59","60-69","70-79","80-100"))

trainData["Sobreviviente"] <-""
trainData$Sobreviviente[trainData$Survived=="1"] <- "SI"
trainData$Sobreviviente[trainData$Survived=="0"] <- "NO"

testData  <- subset( testData , select = -c( Age ) )
trainData <- subset( trainData, select = -c( Age, Survived ) )

```

```{r echo=FALSE, message=FALSE, warning=FALSE}
filasTrain  = dim(trainData)[1]
columTrain = length(trainData)
filasTest  = dim(testData)[1]
columTest  = length(testData)

```


### Nuevo Formato de la data

Nuesta data **test**, ahora presenta `r filasTest` registros (filas) que se corresponden a las reseñas y `r columTest` variables (columnas) que los caracterizan.

 **Atributo**    |    **Descripción**   
-----------------|--------------------------------------------------------------------------
 **Pclass** | Clase Pasajero (1=primera Clase; 2=Segunda Clase; 3=Tercera Clase) 
 **Sex** | Sexo 
 **SibSp** | Número de hermanos/cónyuges a bordo 
 **Parch** | Número de padres/hijos a bordo 
 **Fare** | Tarifa de pasajero 
 **Embarked** | Puerto de embarque (C=Cherbourg; Q=Queenstown; S=Southampton) 
 **Rango_Age** | Rango de Edad 



Nuesta data **train**, ahora presenta `r filasTest` registros (filas) que se corresponden a las reseñas y `r columTrain` variables (columnas) que los caracterizan.

 **Atributo**    |    **Descripción**   
-----------------|--------------------------------------------------------------------------
 **Pclass** | Clase Pasajero (1=primera Clase; 2=Segunda Clase; 3=Tercera Clase) 
 **Sex** | Sexo 
 **SibSp** | Número de hermanos/cónyuges a bordo 
 **Parch** | Número de padres/hijos a bordo 
 **Fare** | Tarifa de pasajero 
 **Embarked** | Puerto de embarque (C=Cherbourg; Q=Queenstown; S=Southampton) 
 **Rango_Age** | Rango de Edad 
 **Sobreviviente** | Indica si el pasajero sobrevició o no al accidente SI-NO



Observamos los datos discretizados.

```{r}
head(trainData)
head(testData)

```

Vemos como los datos se agrupan por segmento de edad.

```{r}
grid.newpage()

#plotTrbyAge <- ggplot(trainData$Rango_Age,main="train. Número de pasajeros por grupos de #edad",xlab="Edad", ylab="Cantidad",col = "ivory")

#plotTebyAge <-ggplot(testData$Rango_Age,main="test. Número de pasajeros por grupos de #edad",xlab="Edad", ylab="Cantidad",col = "ivory")

plotTrbyAge <- ggplot(trainData,aes(Rango_Age))+geom_bar() +labs(x="Rango Edad", y="Pasajero")+ guides(fill=guide_legend(title=""))+ scale_fill_manual(values=c("blue","#008000"))+ggtitle("Datos train")

plotTebyAge <- ggplot(testData,aes(Rango_Age))+geom_bar() +labs(x="Rango Edad", y="Pasajero")+ guides(fill=guide_legend(title=""))+ scale_fill_manual(values=c("blue","#008000"))+ggtitle("Datos test")


grid.arrange(plotTrbyAge,plotTebyAge,ncol=2)

```



### Procesos de análisis visuales del juego de datos

Nos proponemos analizar las relaciones entre las diferentes variables
del juego de datos para ver si se relacionan y como.

Visualizamos la relaciones entre variable 

```{r echo=TRUE, message=FALSE, warning=FALSE}
plotTrbySex1 <- ggplot(data=trainData[1:filasTrain,],aes(x=Sex,fill=Sobreviviente))+geom_bar(position="fill")+ylab("Sobreviviente")+ggtitle("Relación entre las variables genero y sobrevivencia")


plotTrbySex2 <- ggplot(data=trainData[1:filasTrain,],aes(x=Sex,fill=Sobreviviente))+geom_bar()+ylab("Sobreviviente")+ggtitle("Relación entre las variables genero y sobrevivencia")


plotTrbyAge1 <- ggplot(data=trainData[1:filasTrain,],aes(x=Rango_Age,fill=Sobreviviente))+geom_bar(position="fill")+ylab("Sobreviviente")+ggtitle("Relación entre las variables Rango Edad y sobrevivencia")

plotTrbyAge2 <- ggplot(data=trainData[1:filasTrain,],aes(x=Rango_Age,fill=Sobreviviente))+geom_bar()+ylab("Sobreviviente")+ggtitle("Relación entre las variables Rango Edad y sobrevivencia")

plotTrbyCla <- ggplot(data=trainData[1:filasTrain,],aes(x=Pclass,fill=Sobreviviente))+geom_bar(position="fill")+ylab("Sobreviviente")+ggtitle("Relación entre las variables Pclass y sobrevivencia")

plotTrbyEmb <- ggplot(data=trainData[1:filasTrain,],aes(x=Embarked,fill=Sobreviviente))+geom_bar()+ylab("Sobreviviente")+ggtitle("Relación entre las variables Puerto de Embarque y sobrevivencia")

grid.arrange(plotTrbySex1,plotTrbySex2,plotTrbyAge1,plotTrbyAge2,ncol=2)


#grid.newpage()

plotTrbyCla1 <- ggplot(data=trainData[1:filasTrain,],aes(x=Pclass,fill=Sobreviviente))+geom_bar(position="fill")+ylab("Sobreviviente")+ggtitle("Relación entre las variables Pclass y sobrevivencia")

plotTrbyCla2 <- ggplot(data=trainData[1:filasTrain,],aes(x=Pclass,fill=Sobreviviente))+geom_bar()+ylab("Sobreviviente")+ggtitle("Relación entre las variables Pclass y sobrevivencia")

plotTrbyEmb1 <- ggplot(data=trainData[1:filasTrain,],aes(x=Embarked,fill=Sobreviviente))+geom_bar(position="fill")+ylab("Sobreviviente")+ggtitle("Relación entre las variables Puerto de Embarque y sobrevivencia")

plotTrbyEmb2 <- ggplot(data=trainData[1:filasTrain,],aes(x=Embarked,fill=Sobreviviente))+geom_bar()+ylab("Sobreviviente")+ggtitle("Relación entre las variables Puerto de Embarque y sobrevivencia")


grid.arrange(plotTrbyCla1,plotTrbyCla2,plotTrbyEmb1,plotTrbyEmb2,ncol=2)

```

------------------------------------------------------------------------

## Conclusiones previas.

De acuerdo a los graficos obtenidos, Existe una grán posibilidad de sobrevivir, si el pasajeto, es mujer, es menor de 60 años, tiene un ticket de primera clase y embarca en el puerto de Cherbourg. 


------------------------------------------------------------------------


## Fase de Modelado.

En esta fase se construirán y evaluarán varios modelos, se probarán
algoritmos y técnicas hasta encontrar un modelo adecuado. 


## Evaluación

En esta fase se evaluará si el modelo, se adapta a lo esperado.


## Implantación o despliegue.

Esta fase es donde se entrega un objeto, con el cual, el cliente ya
puede obtener resultados.

------------------------------------------------------------------------
















